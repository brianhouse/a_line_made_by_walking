{% extends 'page.html' %}

{% block head %}
    <script type="text/javascript">

        var walk_data = [];
        var walk_index = null;

        function timestamp () {
            return new Date().getTime()
        }

        function checkSelection () {
            walk_index = $('#walk_select option:selected').val();
            if (walk_index.length) {
                $('#start_btn').show();
            } else {
                $('#start_btn').hide();
            }
        }

        function startLog () {
            $('#start_btn').hide();
            $('#stop_btn').show();
            $('#readings').show();
            // alert(walk_index);
            // load sequence
            // count down
            // start playing
            window.ondevicemotion = function(event) {
                var d = [timestamp(), event.accelerationIncludingGravity.x, event.accelerationIncludingGravity.y, event.accelerationIncludingGravity.z];                
                $('#display_x').html(d[1]);
                $('#display_y').html(d[2]);
                $('#display_z').html(d[3]);
                walk_data.push(d);
            }
        }

        function stopLog () {
            $('#stop_btn').hide();
            $('#readings').hide();
            window.ondevicemotion = function(event) { };
            $.ajax({
                type: 'POST',
                url: 'index.py', 
                data: {'walk_data': JSON.stringify(walk_data)}, 
                success: function () {
                    alert("Success!");
                    window.location.reload();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("Failed: " + textStatus);
                    walk_data = [];
                    $('#start_btn').show();                    
                }
            });
        }

        $(document).ready(function() {                   
            $('#start_btn').hide();
            $('#stop_btn').hide();
            $('#readings').hide();            
        });  

    </script>
{% endblock head %}

{% block body %}

    <select id="walk_select" onChange="checkSelection()">
        <option value=""></option>
    {% for timestamp, date in options.items() %}
        <option value="{{ timestamp}}">{{ date }}</a>
    {% endfor %}
    </select>

    <input id="start_btn" type="button" onClick="startLog()" value="START" />
    <input id="stop_btn" type="button" onClick="stopLog()" value="STOP" />

    <div id="readings">
        X: <span id="display_x"></span><br />
        Y: <span id="display_y"></span><br />
        Z: <span id="display_z"></span><br />
    </div>
{% endblock body %}

